.\" Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "SPAMD 1"
.TH SPAMD 1 "2018-09-12" "perl v5.18.2" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
spamd \- daemonized version of spamassassin
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
spamd [options]
.PP
Options:
.PP
.Vb 10
\& \-l, \-\-allow\-tell                  Allow learning/reporting
\& \-c, \-\-create\-prefs                Create user preferences files
\& \-C path, \-\-configpath=path        Path for default config files
\& \-\-siteconfigpath=path             Path for site configs
\& \-\-cf=\*(Aqconfig line\*(Aq                Additional line of configuration
\& \-d, \-\-daemonize                   Daemonize
\& \-h, \-\-help                        Print usage message
\& \-i [ip_or_name[:port]], \-\-listen=[ip_or_name[:port]] Listen on IP addr and port
\& \-p port, \-\-port=port              Listen on specified port, may be overridden by \-i
\& \-4, \-\-ipv4\-only, \-\-ipv4           Use IPv4 where applicable, disables IPv6
\& \-6                                Use IPv6 where applicable, disables IPv4
\& \-A host,..., \-\-allowed\-ips=..,..  Restrict to IP addresses which can connect
\& \-m num, \-\-max\-children=num        Allow maximum num children
\& \-\-min\-children=num                Allow minimum num children
\& \-\-min\-spare=num                   Lower limit for number of spare children
\& \-\-max\-spare=num                   Upper limit for number of spare children
\& \-\-max\-conn\-per\-child=num          Maximum connections accepted by child 
\&                                   before it is respawned
\& \-\-round\-robin                     Use traditional prefork algorithm
\& \-\-timeout\-tcp=secs                Connection timeout for client headers
\& \-\-timeout\-child=secs              Connection timeout for message checks
\& \-q, \-\-sql\-config                  Enable SQL config (needs \-x)
\& \-Q, \-\-setuid\-with\-sql             Enable SQL config (needs \-x,
\&                                   enables use of \-H)
\& \-\-ldap\-config                     Enable LDAP config (needs \-x)
\& \-\-setuid\-with\-ldap                Enable LDAP config (needs \-x,
\&                                   enables use of \-H)
\& \-\-virtual\-config\-dir=dir          Enable pattern based Virtual configs
\&                                   (needs \-x)
\& \-r pidfile, \-\-pidfile             Write the process id to pidfile
\& \-s facility, \-\-syslog=facility    Specify the syslog facility
\& \-\-syslog\-socket=type              How to connect to syslogd
\& \-\-log\-timestamp\-fmt=fmt           strftime(3) format for timestamps, may be
\&                                   empty to disable timestamps, or \*(Aqdefault\*(Aq
\& \-u username, \-\-username=username  Run as username
\& \-g groupname, \-\-groupname=groupname  Run as groupname
\& \-v, \-\-vpopmail                    Enable vpopmail config
\& \-x, \-\-nouser\-config               Disable user config files
\& \-\-auth\-ident                      Use ident to identify spamc user (deprecated)
\& \-\-ident\-timeout=timeout           Timeout for ident connections
\& \-D, \-\-debug[=areas]               Print debugging messages (for areas)
\& \-L, \-\-local                       Use local tests only (no DNS)
\& \-P, \-\-paranoid                    Die upon user errors
\& \-H [dir], \-\-helper\-home\-dir[=dir] Specify a different HOME directory
\& \-\-ssl                             Enable SSL on TCP connections
\& \-\-ssl\-port port                   Override \-\-port setting for SSL connections
\& \-\-ssl\-version sslversion          Specify SSL protocol version to use
\& \-\-server\-key keyfile              Specify an SSL keyfile
\& \-\-server\-cert certfile            Specify an SSL certificate
\& \-\-socketpath=path                 Listen on a given UNIX domain socket
\& \-\-socketowner=name                Set UNIX domain socket file\*(Aqs owner
\& \-\-socketgroup=name                Set UNIX domain socket file\*(Aqs group
\& \-\-socketmode=mode                 Set UNIX domain socket file\*(Aqs mode
\& \-V, \-\-version                     Print version and exit
.Ve
.PP
The \-\-listen option (or \-i) may be specified multiple times, its syntax
is: [ ssl: ] [ host-name-or-IP-address ] [ : port ]  or an absolute path
(filename) of a Unix socket.  If port is omitted it defaults to \-\-port or
to 783.  Option \-\-ssl implies a prefix 'ssl:'.  An IPv6 address should be
enclosed in square brackets, e.g. [::1]:783, an IPv4 address may be but
need not be enclosed in square brackets.  An asterisk '*' in place of a
hostname implies an unspecified address, ('0.0.0.0' or '::'), i.e. it
binds to all interfaces. An empty option value implies '*'. A default
is '\-\-listen localhost', which binds to a loopback interface only.
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The purpose of this program is to provide a daemonized version of the
spamassassin executable.  The goal is improving throughput performance for
automated mail checking.
.PP
This is intended to be used alongside \f(CW\*(C`spamc\*(C'\fR, a fast, low-overhead C client
program.
.PP
See the \s-1README\s0 file in the \f(CW\*(C`spamd\*(C'\fR directory of the SpamAssassin distribution
for more details.
.PP
Note: Although \f(CW\*(C`spamd\*(C'\fR will check per-user config files for every message, any
changes to the system-wide config files will require either restarting spamd
or forcing it to reload itself via \fB\s-1SIGHUP\s0\fR for the changes to take effect.
.PP
Note: If \f(CW\*(C`spamd\*(C'\fR receives a \fB\s-1SIGHUP\s0\fR, it internally reloads itself, which
means that it will change its pid and might not restart at all if its
environment changed  (ie. if it can't change back into its own directory).  If
you plan to use \fB\s-1SIGHUP\s0\fR, you should always start \f(CW\*(C`spamd\*(C'\fR with the \fB\-r\fR
switch to know its current pid.
.SH "OPTIONS"
.IX Header "OPTIONS"
Options of the long form can be shortened as long as they remain
unambiguous.  (i.e. \fB\-\-dae\fR can be used instead of \fB\-\-daemonize\fR)
Also, boolean options (like \fB\-\-user\-config\fR) can be negated by
adding \fIno\fR (\fB\-\-nouser\-config\fR), however, this is usually unnecessary.
.IP "\fB\-l\fR, \fB\-\-allow\-tell\fR" 4
.IX Item "-l, --allow-tell"
Allow learning and forgetting (to a local Bayes database), reporting
and revoking (to a remote database) by spamd. The client issues a \s-1TELL\s0
command to tell what type of message is being processed and whether
local (learn/forget) or remote (report/revoke) databases should be
updated.
.Sp
Note that spamd always trusts the username passed in (unless
\&\fB\-\-auth\-ident\fR is used) so clients could maliciously learn messages
for other users. (This is not ususally a concern with an \s-1SQL\s0 Bayes
store as users will typically have read-write access directly to the
database, and can also use \f(CW\*(C`sa\-learn\*(C'\fR with the \fB\-u\fR option to
achieve the same result.)
.IP "\fB\-c\fR, \fB\-\-create\-prefs\fR" 4
.IX Item "-c, --create-prefs"
Create user preferences files if they don't exist (default: don't).
.IP "\fB\-C\fR \fIpath\fR, \fB\-\-configpath\fR=\fIpath\fR" 4
.IX Item "-C path, --configpath=path"
Use the specified path for locating the distributed configuration files.
Ignore the default directories (usually \f(CW\*(C`/usr/share/spamassassin\*(C'\fR or similar).
.IP "\fB\-\-siteconfigpath\fR=\fIpath\fR" 4
.IX Item "--siteconfigpath=path"
Use the specified path for locating site-specific configuration files.  Ignore
the default directories (usually \f(CW\*(C`/etc/mail/spamassassin\*(C'\fR or similar).
.IP "\fB\-\-cf='config line'\fR" 4
.IX Item "--cf='config line'"
Add additional lines of configuration directly from the command-line, parsed
after the configuration files are read.   Multiple \fB\-\-cf\fR arguments can be
used, and each will be considered a separate line of configuration.
.IP "\fB\-d\fR, \fB\-\-daemonize\fR" 4
.IX Item "-d, --daemonize"
Detach from starting process and run in background (daemonize).
.IP "\fB\-h\fR, \fB\-\-help\fR" 4
.IX Item "-h, --help"
Print a brief help message, then exit without further action.
.IP "\fB\-V\fR, \fB\-\-version\fR" 4
.IX Item "-V, --version"
Print version information, then exit without further action.
.IP "\fB\-i\fR [\fIipaddress\fR[:<port>]], \fB\-\-listen\fR[=\fIipaddress\fR[:<port>]]" 4
.IX Item "-i [ipaddress[:<port>]], --listen[=ipaddress[:<port>]]"
Additional alias names for this option are \-\-listen\-ip and \-\-ip\-address.
Tells spamd to listen on the specified \s-1IP\s0 address, defaults to a loopback
interface, i.e. \f(CW\*(C`\-\-listen localhost\*(C'\fR).  If no value is specified after the
switch, or if an asterisk '*' stands in place of an <ipaddress>, spamd will
listen on all interfaces \- this is equivalent to address '0.0.0.0' for IPv4
and to '::' for IPv6. You can also use a valid hostname which will make spamd
listen on all addresses that a name resolves to. The option may be specified
multiple times. See also options \-4 and \-6 for restricting address family
to IPv4 or to IPv6. If a port is specified it overrides for this socket the
global \-\-port (and \-\-ssl\-port) setting. An IPv6 addresses should be enclosed
in square brackets, e.g. [::1]:783. For compatibility square brackets on an
IPv6 address may be omitted if a port number specification is also omitted.
.IP "\fB\-p\fR \fIport\fR, \fB\-\-port\fR=\fIport\fR" 4
.IX Item "-p port, --port=port"
Optionally specifies the port number for the server to listen on (default: 783).
.Sp
If the \fB\-\-ssl\fR switch is used, and \fB\-\-ssl\-port\fR is not supplied, then this
port will be used to accept \s-1SSL\s0 connections instead of unencrypted connections.
If the \fB\-\-ssl\fR switch is used, and \fB\-\-ssl\-port\fR is set, then unencrypted
connections will be accepted on the \fB\-\-port\fR at the same time as encrypted
connections are accepted at \fB\-\-ssl\-port\fR.
.IP "\fB\-q\fR, \fB\-\-sql\-config\fR" 4
.IX Item "-q, --sql-config"
Turn on \s-1SQL\s0 lookups even when per-user config files have been disabled
with \fB\-x\fR. this is useful for spamd hosts which don't have user's
home directories but do want to load user preferences from an \s-1SQL\s0
database.
.Sp
If your spamc client does not support sending the \f(CW\*(C`User:\*(C'\fR header,
like \f(CW\*(C`exiscan\*(C'\fR, then the \s-1SQL\s0 username used will always be \fBnobody\fR.
.Sp
This inhibits the \fIsetuid()\fR behavior, so the \f(CW\*(C`\-u\*(C'\fR option is
required. If you want the \fIsetuid()\fR behaviour, use \f(CW\*(C`\-Q\*(C'\fR or
\&\f(CW\*(C`\-\-setuid\-with\-sql\*(C'\fR instead.
.IP "\fB\-\-ldap\-config\fR" 4
.IX Item "--ldap-config"
Turn on \s-1LDAP\s0 lookups. This is completely analog to \f(CW\*(C`\-\-sql\-config\*(C'\fR,
only it is using an \s-1LDAP\s0 server.
.Sp
Like \f(CW\*(C`\-\-sql\-config\*(C'\fR, this disables the setuid behavior, and requires
\&\f(CW\*(C`\-u\*(C'\fR. If you want it, use \f(CW\*(C`\-\-setuid\-with\-ldap\*(C'\fR instead.
.IP "\fB\-Q\fR, \fB\-\-setuid\-with\-sql\fR" 4
.IX Item "-Q, --setuid-with-sql"
Turn on \s-1SQL\s0 lookups even when per-user config files have been disabled
with \fB\-x\fR and also setuid to the user.  This is useful for spamd hosts
which want to load user preferences from an \s-1SQL\s0 database but also wish to
support the use of \fB\-H\fR (Helper home directories.)
.IP "\fB\-\-setuid\-with\-ldap\fR" 4
.IX Item "--setuid-with-ldap"
Turn on \s-1LDAP\s0 lookups even when per-user config files have been disabled
with \fB\-x\fR and also setuid to the user.  This is again completely analog
to \f(CW\*(C`\-\-setuid\-with\-sql\*(C'\fR, only it is using an \s-1LDAP\s0 server.
.IP "\fB\-\-virtual\-config\-dir\fR=\fIpattern\fR" 4
.IX Item "--virtual-config-dir=pattern"
This option specifies where per-user preferences can be found for virtual
users, for the \fB\-x\fR switch. The \fIpattern\fR is used as a base pattern for the
directory name.  Any of the following escapes can be used:
.RS 4
.ie n .IP "%u \*(-- replaced with the full name of the current user, as sent by spamc." 4
.el .IP "\f(CW%u\fR \*(-- replaced with the full name of the current user, as sent by spamc." 4
.IX Item "%u replaced with the full name of the current user, as sent by spamc."
.PD 0
.ie n .IP "%l \*(-- replaced with the 'local part' of the current username.  In other words, if the username is an email address, this is the part before the ""@"" sign." 4
.el .IP "\f(CW%l\fR \*(-- replaced with the 'local part' of the current username.  In other words, if the username is an email address, this is the part before the \f(CW@\fR sign." 4
.IX Item "%l replaced with the 'local part' of the current username. In other words, if the username is an email address, this is the part before the @ sign."
.ie n .IP "%d \*(-- replaced with the 'domain' of the current username.  In other words, if the username is an email address, this is the part after the ""@"" sign." 4
.el .IP "\f(CW%d\fR \*(-- replaced with the 'domain' of the current username.  In other words, if the username is an email address, this is the part after the \f(CW@\fR sign." 4
.IX Item "%d replaced with the 'domain' of the current username. In other words, if the username is an email address, this is the part after the @ sign."
.IP "%% \*(-- replaced with a single percent sign (%)." 4
.IX Item "%% replaced with a single percent sign (%)."
.RE
.RS 4
.PD
.Sp
So for example, if \f(CW\*(C`/vhome/users/%u/spamassassin\*(C'\fR is specified, and spamc
sends a virtual username of \f(CW\*(C`jm@example.com\*(C'\fR, the directory
\&\f(CW\*(C`/vhome/users/jm@example.com/spamassassin\*(C'\fR will be used.
.Sp
The set of characters allowed in the virtual username for this path are
restricted to:
.Sp
.Vb 1
\&        A\-Z a\-z 0\-9 \- + _ . , @ =
.Ve
.Sp
All others will be replaced by underscores (\f(CW\*(C`_\*(C'\fR).
.Sp
This path must be a writable directory.  It will be created if it does not
already exist.  If a file called \fBuser_prefs\fR exists in this directory (note:
\&\fBnot\fR in a \f(CW\*(C`.spamassassin\*(C'\fR subdirectory!), it will be loaded as the user's
preferences.  The Bayes databases for that user will be stored in this directory.
.Sp
Note that this \fBrequires\fR that \fB\-x\fR is used, and cannot be combined with
\&\s-1SQL\-\s0 or LDAP-based configuration.
.Sp
The pattern \fBmust\fR expand to an absolute directory when spamd is running
daemonized (\fB\-d\fR).
.Sp
Currently, use of this without \fB\-u\fR is not supported. This inhibits setuid.
.RE
.IP "\fB\-r\fR \fIpidfile\fR, \fB\-\-pidfile\fR=\fIpidfile\fR" 4
.IX Item "-r pidfile, --pidfile=pidfile"
Write the process \s-1ID\s0 of the spamd parent to the file specified by \fIpidfile\fR.
The file will be unlinked when the parent exits.  Note that when running
with the \fB\-u\fR option, the file must be writable by that user.
.IP "\fB\-v\fR, \fB\-\-vpopmail\fR" 4
.IX Item "-v, --vpopmail"
Enable vpopmail config.  If specified with with \fB\-u\fR set to the vpopmail user,
this allows spamd to lookup/create user_prefs in the vpopmail user's own
maildir.  This option is useful for vpopmail virtual users who do not have an
entry in the system /etc/passwd file.
.Sp
Currently, use of this without \fB\-u\fR is not supported. This inhibits setuid.
.IP "\fB\-s\fR \fIfacility\fR, \fB\-\-syslog\fR=\fIfacility\fR" 4
.IX Item "-s facility, --syslog=facility"
Specify the syslog facility to use (default: mail).  If \f(CW\*(C`stderr\*(C'\fR is specified,
output will be written to stderr. (This is useful if you're running \f(CW\*(C`spamd\*(C'\fR
under the \f(CW\*(C`daemontools\*(C'\fR package.) With a \fIfacility\fR of \f(CW\*(C`file\*(C'\fR, all output
goes to spamd.log. \fIfacility\fR is interpreted as a file name to log to if it
contains any characters except a\-z and 0\-9. \f(CW\*(C`null\*(C'\fR disables logging completely
(used internally).
.Sp
Examples:
	spamd \-s mail                 # use syslog, facility mail (default)
	spamd \-s ./mail               # log to file ./mail
	spamd \-s stderr 2>/dev/null   # log to stderr, throw messages away
	spamd \-s null                 # the same as above
	spamd \-s file                 # log to file ./spamd.log
	spamd \-s /var/log/spamd.log   # log to file /var/log/spamd.log
.Sp
If logging to a file is enabled and that log file is rotated, the spamd server
must be restarted with a \s-1SIGHUP. \s0(If the log file is just truncated, this is
not needed but still recommended.)
.Sp
Note that logging to a file does not use locking, so you cannot intermix
logging from spamd and other processes into the same file.  If you want
to mix logging like this, use syslog instead.
.Sp
If you use syslog logging, it is essential to send a \s-1SIGHUP\s0 to the spamd daemon
when you restart the syslogd daemon.  (This is due to a shortcoming in Perl's
syslog handling, where the disappearance of the connection to the syslogd is
considered a fatal error.)
.IP "\fB\-\-syslog\-socket\fR=\fItype\fR" 4
.IX Item "--syslog-socket=type"
Specify how spamd should send messages to syslogd. The \fItype\fR can be any
of the socket types or logging mechanisms as accepted by the subroutine
\&\fISys::Syslog::setlogsock()\fR. Depending on a version of Sys::Syslog and on the
underlying operating system, one of the following values (or their subset) can
be used: \f(CW\*(C`native\*(C'\fR, \f(CW\*(C`eventlog\*(C'\fR, \f(CW\*(C`tcp\*(C'\fR, \f(CW\*(C`udp\*(C'\fR, \f(CW\*(C`inet\*(C'\fR, \f(CW\*(C`unix\*(C'\fR, \f(CW\*(C`stream\*(C'\fR,
\&\f(CW\*(C`pipe\*(C'\fR, or \f(CW\*(C`console\*(C'\fR.  The value \f(CW\*(C`eventlog\*(C'\fR is specific to Win32 events
logger and requires a perl module Win32::EventLog to be installed.
For more information please consult the Sys::Syslog documentation.
.Sp
A historical setting \-\-syslog\-socket=none is mapped to \-\-syslog=stderr.
.Sp
A default for Windows platforms is \f(CW\*(C`none\*(C'\fR, otherwise the default is
to try \f(CW\*(C`unix\*(C'\fR first, falling back to \f(CW\*(C`inet\*(C'\fR if perl detects errors
in its \f(CW\*(C`unix\*(C'\fR support.
.Sp
Some platforms, or versions of perl, are shipped with old or dysfunctional
versions of the \fBSys::Syslog\fR module which do not support some socket types,
so you may need to set this option explicitly.  If you get error messages
regarding \fB_\|_PATH_LOG\fR or similar spamd, try changing this setting.
.Sp
The socket types \f(CW\*(C`file\*(C'\fR is used internally and should not be specified.
Use the \f(CW\*(C`\-s\*(C'\fR switch instead.
.IP "\fB\-\-log\-timestamp\-fmt\fR=\fIformat\fR" 4
.IX Item "--log-timestamp-fmt=format"
The \-\-log\-timestamp\-fmt option can provide a \s-1POSIX\s0 \fIstrftime\fR\|(3) format for
timestamps included in each logged message. Each logger (stderr, file,
syslog) has its own default value for a timestamp format, which applies when
\&\-\-log\-timestamp\-fmt option is not given, or with \-\-log\-timestamp\-fmt=default .
Timestamps can be turned off by specifying an empty string with this
option, e.g. \-\-log\-timestamp\-fmt='' or just \-\-log\-timestamp\-fmt= .
Typical use: \-\-log\-timestamp\-fmt='%a \f(CW%b\fR \f(CW%e\fR \f(CW%H:\fR%M:%S \f(CW%Y\fR' (provides
localized weekday and month names in the \fIctime\fR\|(3) style),
or '%a, \f(CW%e\fR \f(CW%b\fR \f(CW%Y\fR \f(CW%H:\fR%M:%S \f(CW%z\fR (%Z)' for a \s-1RFC 2822\s0 format,
or maybe '%Y\-%m\-%d \f(CW%H:\fR%M:%S%z' for an \s-1ISO 8601 \s0(\s-1EN 28601\s0) format,
or just '%Y%m%dT%H%M%S' .
.IP "\fB\-u\fR \fIusername\fR, \fB\-\-username\fR=\fIusername\fR" 4
.IX Item "-u username, --username=username"
Run as the named user.  If this option is not set, the default behaviour
is to \fIsetuid()\fR to the user running \f(CW\*(C`spamc\*(C'\fR, if \f(CW\*(C`spamd\*(C'\fR is running
as root.
.Sp
Note: \*(L"\-\-username=root\*(R" is not a valid option.  If specified, \f(CW\*(C`spamd\*(C'\fR will
exit with a fatal error on startup.
.IP "\fB\-g\fR \fIgroupname\fR, \fB\-\-groupname\fR=\fIgroupname\fR" 4
.IX Item "-g groupname, --groupname=groupname"
Run as the named group if \-\-username is being used. If this option is
not set when \-\-username is used then the primary group for the user
given to \-\-username is used.
.IP "\fB\-x\fR, \fB\-\-nouser\-config\fR, \fB\-\-user\-config\fR" 4
.IX Item "-x, --nouser-config, --user-config"
Turn off (on) reading of per-user configuration files (user_prefs) from the
user's home directory.  The default behaviour is to read per-user
configuration from the user's home directory (\fB\-\-user\-config\fR).
.Sp
This option does not disable or otherwise influence the \s-1SQL, LDAP\s0 or
Virtual Config Dir settings.
.IP "\fB\-\-auth\-ident\fR" 4
.IX Item "--auth-ident"
Verify the username provided by spamc using ident.  This is only
useful if connections are only allowed from trusted hosts (because an
identd that lies is trivial to create) and if spamc \s-1REALLY SHOULD\s0 be
running as the user it represents.  Connections are terminated
immediately if authentication fails.  In this case, spamc will pass
the mail through unchecked.  Failure to connect to an ident server,
and response timeouts are considered authentication failures.  This
requires that Net::Ident be installed. Deprecated.
.IP "\fB\-\-ident\-timeout\fR=\fItimeout\fR" 4
.IX Item "--ident-timeout=timeout"
Wait at most \fItimeout\fR seconds for a response to ident queries.
Ident query that takes longer that \fItimeout\fR seconds will fail, and
mail will not be processed.  Setting this to 0.0 or less results in no
timeout, which is \s-1STRONGLY\s0 discouraged.  The default is 5 seconds.
.IP "\fB\-A\fR \fIhost,...\fR, \fB\-\-allowed\-ips\fR=\fIhost,...\fR" 4
.IX Item "-A host,..., --allowed-ips=host,..."
Specify a comma-separated list of authorized hosts or networks which
can connect to this spamd instance. Each element of the list is either a
single \s-1IP\s0 addresses, or a range of \s-1IP\s0 addresses in address/masklength \s-1CIDR\s0
notation, or ranges of IPv4 addresses by specifying 3 or less octets with
a trailing dot.  Hostnames are not supported, only IPv4 or IPv6 addresses.
This option can be specified multiple times, or can take a list of addresses
separated by commas.  IPv6 addresses may be (but need not be) enclosed
in square brackets for consistency with option \fB\-\-listen\fR.  Examples:
.Sp
\&\fB\-A 10.11.12.13\fR \*(-- only allow connections from \f(CW10.11.12.13\fR.
.Sp
\&\fB\-A 10.11.12.13,10.11.12.14\fR \*(-- only allow connections from \f(CW10.11.12.13\fR and
\&\f(CW10.11.12.14\fR.
.Sp
\&\fB\-A 10.200.300.0/24\fR \*(-- allow connections from any machine in the range
\&\f(CW\*(C`10.200.300.*\*(C'\fR.
.Sp
\&\fB\-A 10.\fR \*(-- allow connections from any machine in the range \f(CW\*(C`10.*.*.*\*(C'\fR.
.Sp
\&\fB\-A [2001:db8::]/32,192.0.2.0/24,::1,127.0.0.0/8\fR \*(-- only accept
connections from specified test networks and from localhost.
.Sp
In absence of the \fB\-A\fR option, connections are only accepted from
\&\s-1IP\s0 address 127.0.0.1 or ::1, i.e. from localhost on a loopback interface.
.IP "\fB\-D\fR [\fIarea,...\fR], \fB\-\-debug\fR [\fIarea,...\fR]" 4
.IX Item "-D [area,...], --debug [area,...]"
Produce debugging output. If no areas are listed, all debugging information is
printed. Diagnostic output can also be enabled for each area individually;
\&\fIarea\fR is the area of the code to instrument. For example, to produce
diagnostic output on bayes, learn, and dns, use:
.Sp
.Vb 1
\&        spamassassin \-D bayes,learn,dns
.Ve
.Sp
Higher priority informational messages that are suitable for logging in normal
circumstances are available with an area of \*(L"info\*(R".
.Sp
For more information about which areas (also known as channels) are available,
please see the documentation at:
.Sp
.Vb 1
\&        C<http://wiki.apache.org/spamassassin/DebugChannels>
.Ve
.IP "\fB\-4\fR, \fB\-\-ipv4only\fR, \fB\-\-ipv4\-only\fR, \fB\-\-ipv4\fR" 4
.IX Item "-4, --ipv4only, --ipv4-only, --ipv4"
Use IPv4 where applicable, do not use IPv6.
The option affects a set of listen sockets (see option \f(CW\*(C`\-\-listen\*(C'\fR)
and disables IPv6 for \s-1DNS\s0 tests.
.IP "\fB\-6\fR" 4
.IX Item "-6"
Use IPv6 where applicable, do not use IPv4.
The option affects a set of listen sockets (see option \f(CW\*(C`\-\-listen\*(C'\fR)
and disables IPv4 for \s-1DNS\s0 tests. Installing a module IO::Socket::IP
is recommended if spamd is expected to receive requests over IPv6.
.IP "\fB\-L\fR, \fB\-\-local\fR" 4
.IX Item "-L, --local"
Perform only local tests on all mail.  In other words, skip \s-1DNS\s0 and other
network tests.  Works the same as the \f(CW\*(C`\-L\*(C'\fR flag to \f(CWspamassassin(1)\fR.
.IP "\fB\-P\fR, \fB\-\-paranoid\fR" 4
.IX Item "-P, --paranoid"
Die on user errors (for the user passed from spamc) instead of falling back to
user \fInobody\fR and using the default configuration.
.IP "\fB\-m\fR \fInumber\fR , \fB\-\-max\-children\fR=\fInumber\fR" 4
.IX Item "-m number , --max-children=number"
This option specifies the maximum number of children to spawn.
Spamd will spawn that number of children, then sleep in the background
until a child dies, wherein it will go and spawn a new child.
.Sp
Incoming connections can still occur if all of the children are busy,
however those connections will be queued waiting for a free child.
The minimum value is \f(CW1\fR, the default value is \f(CW5\fR.
.Sp
Please note that there is a \s-1OS\s0 specific maximum of connections that can be
queued (Try \f(CW\*(C`perl \-MSocket \-e\*(Aqprint SOMAXCONN\*(Aq\*(C'\fR to find this maximum).
.Sp
Note that if you run too many servers for the amount of free \s-1RAM\s0 available, you
run the danger of hurting performance by causing a high swap load as server
processes are swapped in and out continually.
.IP "\fB\-\-min\-children\fR=\fInumber\fR" 4
.IX Item "--min-children=number"
The minimum number of children that will be kept running.  The minimum value is
\&\f(CW1\fR, the default value is \f(CW1\fR.  If you have lots of free \s-1RAM,\s0 you may want to
increase this.
.IP "\fB\-\-min\-spare\fR=\fInumber\fR" 4
.IX Item "--min-spare=number"
The lower limit for the number of spare children allowed to run.  A
spare, or idle, child is one that is not handling a scan request.   If
there are too few spare children available, a new server will be started
every second or so.  The default value is \f(CW1\fR.
.IP "\fB\-\-max\-spare\fR=\fInumber\fR" 4
.IX Item "--max-spare=number"
The upper limit for the number of spare children allowed to run.  If there
are too many spare children, one will be killed every second or so until
the number of idle children is in the desired range.  The default value
is \f(CW2\fR.
.IP "\fB\-\-max\-conn\-per\-child\fR=\fInumber\fR" 4
.IX Item "--max-conn-per-child=number"
This option specifies the maximum number of connections each child
should process before dying and letting the master spamd process spawn
a new child.  The minimum value is \f(CW1\fR, the default value is \f(CW200\fR.
.IP "\fB\-\-round\-robin\fR" 4
.IX Item "--round-robin"
By default, \f(CW\*(C`spamd\*(C'\fR will attempt to keep a small number of \*(L"hot\*(R" child
processes as busy as possible, and keep any others as idle as possible, using
something similar to the Apache httpd server scaling algorithm.  This is
accomplished by the master process coordinating the activities of the children.
This switch will disable this scaling algorithm, and the behaviour seen in
the 3.0.x versions will be used instead, where all processes receive an
equal load and no scaling takes place.
.IP "\fB\-\-timeout\-tcp\fR=\fInumber\fR" 4
.IX Item "--timeout-tcp=number"
This option specifies the number of seconds to wait for headers from a
client (spamc) before closing the connection.  The minimum value is \f(CW1\fR, 
the default value is \f(CW30\fR, and a value of \f(CW0\fR will disable socket
timeouts completely.
.IP "\fB\-\-timeout\-child\fR=\fInumber\fR" 4
.IX Item "--timeout-child=number"
This option specifies the number of seconds to wait for a spamd child to
process or check a message.  The minimum value is \f(CW1\fR, the default 
value is \f(CW300\fR, and a value of \f(CW0\fR will disable child timeouts completely.
.IP "\fB\-H\fR \fIdirectory\fR, \fB\-\-helper\-home\-dir\fR=\fIdirectory\fR" 4
.IX Item "-H directory, --helper-home-dir=directory"
Specify that external programs such as Razor, \s-1DCC,\s0 and Pyzor should have
a \s-1HOME\s0 environment variable set to a specific directory.  The default
is to use the \s-1HOME\s0 environment variable setting from the shell running
spamd.  By specifying no argument, spamd will use the spamc caller's
home directory instead.
.IP "\fB\-\-ssl\fR" 4
.IX Item "--ssl"
Accept only \s-1SSL\s0 connections on the associated port.
The \fBIO::Socket::SSL\fR perl module must be installed.
.Sp
If the \fB\-\-ssl\fR switch is used, and \fB\-\-ssl\-port\fR is not supplied, then
\&\fB\-\-port\fR port will be used to accept \s-1SSL\s0 connections instead of unencrypted
connections.  If the \fB\-\-ssl\fR switch is used, and \fB\-\-ssl\-port\fR is set, then
unencrypted connections will be accepted on the \fB\-\-port\fR, at the same time as
encrypted connections are accepted at \fB\-\-ssl\-port\fR.
.IP "\fB\-\-ssl\-port\fR=\fIport\fR" 4
.IX Item "--ssl-port=port"
Optionally specifies the port number for the server to listen on for
\&\s-1SSL\s0 connections (default: whatever \-\-port uses).  See \fB\-\-ssl\fR for
more details.
.IP "\fB\-\-ssl\-version\fR=\fIsslversion\fR" 4
.IX Item "--ssl-version=sslversion"
Specify the \s-1SSL\s0 protocol version to use, one of \fBsslv3\fR or \fBtlsv1\fR.
The default, \fBsslv3\fR, is the most flexible, accepting a SSLv3 or
higher hello handshake, then negotiating use of SSLv3 or TLSv1
protocol if the client can accept it.  Specifying \fB\-\-ssl\-version\fR
implies \fB\-\-ssl\fR.
.IP "\fB\-\-server\-key\fR \fIkeyfile\fR" 4
.IX Item "--server-key keyfile"
Specify the \s-1SSL\s0 key file to use for \s-1SSL\s0 connections.
.IP "\fB\-\-server\-cert\fR \fIcertfile\fR" 4
.IX Item "--server-cert certfile"
Specify the \s-1SSL\s0 certificate file to use for \s-1SSL\s0 connections.
.IP "\fB\-\-socketpath\fR \fIpathname\fR" 4
.IX Item "--socketpath pathname"
Listen on a \s-1UNIX\s0 domain socket at path \fIpathname\fR, in addition to
sockets specified with a \f(CW\*(C`\-\-listen\*(C'\fR option. This option is provided
for compatibility with older versions of spamd. Starting with version
3.4.0 the \f(CW\*(C`\-\-listen\*(C'\fR option can also take a \s-1UNIX\s0 domain socket as its
value (an absolute path name). Unlike \f(CW\*(C`\-\-socketpath\*(C'\fR, the \f(CW\*(C`\-\-listen\*(C'\fR
option may be specified multiple times if spamd needs to listen on
multiple \s-1UNIX\s0 or \s-1INET\s0 or \s-1INET6\s0 sockets.
.Sp
Warning: the Perl support on \s-1BSD\s0 platforms for \s-1UNIX\s0 domain sockets seems to
have a bug regarding paths of over 100 bytes or so (SpamAssassin bug 4380).
If you see a 'could not find newly-created \s-1UNIX\s0 socket' error message, and
the path appears truncated, this may be the cause.  Try using a shorter path
to the socket.
.Sp
By default, use of \fB\-\-socketpath\fR without \fB\-\-listen\fR will inhibit
\&\s-1SSL\s0 connections and unencrypted \s-1TCP\s0 connections.  To add other sockets,
specify them with \fB\-\-listen\fR, e.g. '\-\-listen=:' or '\-\-listen=*:'
.IP "\fB\-\-socketowner\fR \fIname\fR" 4
.IX Item "--socketowner name"
Set \s-1UNIX\s0 domain socket to be owned by the user named \fIname\fR.  Note
that this requires that spamd be started as \f(CW\*(C`root\*(C'\fR, and if \f(CW\*(C`\-u\*(C'\fR
is used, that user should have write permissions to unlink the file
later, for when the \f(CW\*(C`spamd\*(C'\fR server is killed.
.IP "\fB\-\-socketgroup\fR \fIname\fR" 4
.IX Item "--socketgroup name"
Set \s-1UNIX\s0 domain socket to be owned by the group named \fIname\fR.  See
\&\f(CW\*(C`\-\-socketowner\*(C'\fR for notes on ownership and permissions.
.IP "\fB\-\-socketmode\fR \fImode\fR" 4
.IX Item "--socketmode mode"
Set \s-1UNIX\s0 domain socket to use the octal mode \fImode\fR.  Note that if \f(CW\*(C`\-u\*(C'\fR is
used, that user should have write permissions to unlink the file later, for
when the \f(CW\*(C`spamd\*(C'\fR server is killed.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIspamc\fR\|(1)
\&\fIspamassassin\fR\|(1)
\&\fIMail::SpamAssassin::Conf\fR\|(3)
\&\fIMail::SpamAssassin\fR\|(3)
.SH "PREREQUISITES"
.IX Header "PREREQUISITES"
\&\f(CW\*(C`Mail::SpamAssassin\*(C'\fR
.SH "AUTHORS"
.IX Header "AUTHORS"
The SpamAssassin(tm) Project (http://spamassassin.apache.org/)
.SH "LICENSE"
.IX Header "LICENSE"
SpamAssassin is distributed under the Apache License, Version 2.0, as
described in the file \f(CW\*(C`LICENSE\*(C'\fR included with the distribution.
